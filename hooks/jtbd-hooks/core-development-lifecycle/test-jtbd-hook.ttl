@prefix ex: <http://example.org/> .
@prefix gv: <https://gitvan.dev/ontology#> .
@prefix gh: <https://gitvan.dev/graph-hook#> .
@prefix op: <https://gitvan.dev/op#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .

# Test JTBD Hook Hook - JTBD Template
# Generated: 2025-09-20T20:55:59.087Z
# Category: core-development-lifecycle

ex:test-jtbd-hook-hook rdf:type gh:Hook ;
    gv:title "Test JTBD Hook" ;
    gh:hasPredicate ex:test-jtbd-hook-predicate ;
    gh:orderedPipelines ex:test-jtbd-hook-pipeline .

# ASK Predicate - "Condition" Sensor
ex:test-jtbd-hook-predicate rdf:type gh:ASKPredicate ;
    gh:queryText """
        PREFIX gv: <https://gitvan.dev/ontology#>
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        
        ASK WHERE {
            ?file rdf:type gv:SourceFile .
            ?file gv:hasIssue ?issue .
            ?issue gv:severity ?severity .
            FILTER(?severity IN ("high", "critical"))
        }
    """ ;
    gh:description "Detects issues requiring attention" .

# Workflow Pipeline
ex:test-jtbd-hook-pipeline rdf:type op:Pipeline ;
    op:steps (ex:test-jtbd-hook-step1, ex:test-jtbd-hook-step2) .

# Step 1: Analyze
ex:test-jtbd-hook-step1 rdf:type gv:SparqlStep ;
    gv:text """
        PREFIX gv: <https://gitvan.dev/ontology#>
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        
        SELECT ?file ?issue ?severity WHERE {
            ?file rdf:type gv:SourceFile .
            ?file gv:hasIssue ?issue .
            ?issue gv:severity ?severity .
            FILTER(?severity IN ("high", "critical"))
        } ORDER BY ?severity DESC, ?file
    """ ;
    gv:outputMapping '{"issues": "results", "issueCount": "results.length"}' .

# Step 2: Report
ex:test-jtbd-hook-step2 rdf:type gv:TemplateStep ;
    gv:text """
        # Test JTBD Hook Report
        
        **Generated:** {{ "now" | date("YYYY-MM-DD HH:mm:ss") }}  
        **Hook:** Test JTBD Hook  
        **Status:** {{ issueCount > 0 ? "ðŸš¨ ISSUES DETECTED" : "âœ… ALL CLEAR" }}  
        **Issue Count:** {{ issueCount }}
        
        ## Issues Detected
        
        {% for issue in issues %}
        ### {{ issue.file.value }}
        - **Severity:** {{ issue.severity.value }}
        {% endfor %}
        
        ---
        *This report was automatically generated by the Test JTBD Hook Hook*
    """ ;
    gv:filePath "./reports/jtbd/core-development-lifecycle/test-jtbd-hook-{{ 'now' | date('YYYY-MM-DD-HH-mm-ss') }}.md" ;
    gv:dependsOn ex:test-jtbd-hook-step1 .
